<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAA+vr/ABFmmQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAICAgICAgICAAAAAAAAAgICAgECAgICAgICAAAAAgICAgIBAgICAgICAgIAAAICAgICAQEBAgICAgICAAICAgICAgECAgECAgECAQICAgICAgIBAgICAQIBAQECAgICAgICAQICAQICAQIBAgICAgECAgEBAQICAgIBAgICAgIBAgICAgICAgICAgICAgICAQEBAgICAgICAgICAgICAgECAgECAgIBAgICAgICAgIBAgICAQIBAgECAgICAAICAQICAQICAQIBAgICAAACAgEBAQICAgIBAgICAgAAAAICAgICAgICAgICAgAAAAAAAAICAgICAgICAAAAAPAPAADAAwAAgAEAAIABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIABAACAAQAAwAMAAPAPAAA=" rel="icon" type="image/x-icon">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <title>–í—ã–±–æ—Ä –¥–æ–º–∞</title>
  <style>
    body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 20px;
    background: #f5f7fa;
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
  }
  .house {
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 16px;
    margin: 16px 8px;
    width: 290px;
    display: inline-block;
    vertical-align: top;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    transition: transform 0.2s;
  }
  .house:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .house img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 12px;
  }
  input[type="text"] {
    padding: 10px;
    width: 320px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  button {
    padding: 12px 24px;
    font-size: 18px;
    background: #1a73e8;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background: #0d5bb8;
  }
  #status {
    margin-top: 20px;
    font-weight: bold;
    min-height: 24px;
  }
  h2 {
    color: #202124;
    margin-bottom: 10px;
  }

    .results-box {
  background: white;
  border-radius: 12px;
  padding: 16px;
  margin-top: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.results-title {
  font-weight: bold;
  margin-bottom: 12px;
  color: #202124;
}

.result-row {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #f0f0f0;
  color: #333;
}

.result-count {
  font-weight: bold;
  color: #1a73e8;
}
  @media (max-width: 600px) {
  .result-row {
    flex-direction: column;
    gap: 4px;
  }
  .result-row span:last-child {
    text-align: right;
  }
}
    #house-map {
    width: 100%;
    height: 300px;
    border-radius: 12px;
    margin: 20px 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }
  </style>
</head>
<body>
  <h2>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥–æ–º–∞ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</h2>
  <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)" />
  <h3>–ì–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–æ–º–∞</h3>
  <div id="house-map"></div>
  <div id="houses-container">
    <!-- –î–æ–º–∞ –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è —Å—é–¥–∞ -->
  </div>

  <br><br>
  <button onclick="submitVote()">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å</button>
  <h3>–¢–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
<div id="results-container">
  <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</p>
</div>
  <div id="status"></div>

  <script>
  // üî¥ –£–ë–ï–†–ò –ü–†–û–ë–ï–õ–´ –í –ö–û–ù–¶–ï URL!
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwrMeJhIM7_Hq9viUzcu7KXAGdv1brBFlWfP7Wvmx2a6L71HvpXgmIk06zFruYZBpl-vg/exec";

  async function loadHouses() {
    try {
      const res = await fetch(`${WEB_APP_URL}?action=getHouses`);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const houses = await res.json();
      
      const container = document.getElementById("houses-container");
      if (houses.length === 0) {
        container.innerHTML = "<p>–ù–µ—Ç –¥–æ–º–æ–≤ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.</p>";
        return;
      }

      container.innerHTML = houses.map(h => `
        <label class="house">
          <input type="checkbox" value="${h.id}">
          <img src="${h.—Ñ–æ—Ç–æ_url}" onerror="this.src='https://via.placeholder.com/300x150?text=–§–æ—Ç–æ+–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ'">
          <div><strong>${h.–Ω–∞–∑–≤–∞–Ω–∏–µ}</strong></div>
          <div>üí∞ –°—É—Ç–∫–∏: ${h.—Ü–µ–Ω–∞_—Å—É—Ç–∫–∏ || '‚Äî'} ‚ÇΩ</div>
          <div>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ 3 —Å–µ–º—å–∏ —Ç–æ–º—Å–∫–∏–µ: ${h.—Ü–µ–Ω–∞_—Ç–æ–º—Å–∫–∏–µ || '‚Äî'} ‚ÇΩ</div>
          <div>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ 1 —Å–µ–º—å—è: ${h.—Ü–µ–Ω–∞_–∫—Ä–∞—Å || '‚Äî'} ‚ÇΩ</div>
          <div>‚ú®–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ ${h.–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ || ''}</div>
          <div>üó∫Ô∏è –î–æ –≥–æ—Ä—ã: ${h.—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ || '‚Äî'} –∫–º</div>
          <div><a href="${h.–∞–≤–∏—Ç–æ_—Å—Å—ã–ª–∫–∞}" target="_blank" style="color: #0066cc; text-decoration: underline;">üîó –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –ê–≤–∏—Ç–æ</a></div>
        </label>
      `).join('');
      // --- –ö–∞—Ä—Ç–∞ ---
if (typeof L !== 'undefined') {
  const mapContainer = document.getElementById('house-map');
  if (mapContainer) {
    // –û—á–∏—Å—Ç–∏–º –∫–∞—Ä—Ç—É, –µ—Å–ª–∏ —É–∂–µ –±—ã–ª–∞
    mapContainer.innerHTML = '';

    // –°–æ–∑–¥–∞—ë–º –∫–∞—Ä—Ç—É
    const map = L.map('house-map').setView([52.57, 87.57], 12); // —Ü–µ–Ω—Ç—Ä ‚Äî —Ç–≤–æ–π —Ä–µ–≥–∏–æ–Ω

    // –ü–æ–¥–ª–æ–∂–∫–∞ OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
    houses.forEach(house => {
      if (house.—à–∏—Ä–æ—Ç–∞ && house.–¥–æ–ª–≥–æ—Ç–∞) {
        const lat = parseFloat(house.—à–∏—Ä–æ—Ç–∞);
        const lng = parseFloat(house.–¥–æ–ª–≥–æ—Ç–∞);
        
        if (!isNaN(lat) && !isNaN(lng)) {
          const marker = L.marker([lat, lng]).addTo(map);
          
          // –ü–æ–ø–∞–ø —Å —Ñ–æ—Ç–æ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º
          let popupContent = `<strong>${house.–Ω–∞–∑–≤–∞–Ω–∏–µ}</strong>`;
          if (house.—Ñ–æ—Ç–æ_url) {
            popupContent += `<br><img src="${house.—Ñ–æ—Ç–æ_url}" width="150" style="border-radius: 6px; margin-top: 6px;">`;
          }
          marker.bindPopup(popupContent);
        }
      }
    });
  }
}
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–º–æ–≤:", err);
      document.getElementById("houses-container").innerHTML = 
        `<p style="color:red">‚ùå –û—à–∏–±–∫–∞: ${err.message}</p>`;
    }
  }

  async function submitVote() {
    const name = document.getElementById("name").value.trim() || "–ê–Ω–æ–Ω–∏–º";
    const checked = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
      .map(el => el.value);

    if (checked.length === 0) {
      alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–æ–º!");
      return;
    }

    const housesParam = encodeURIComponent(checked.join(","));
    const url = `${WEB_APP_URL}?action=vote&name=${encodeURIComponent(name)}&houses=${housesParam}`;

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const result = await res.json();
      if (result.status === "ok") {
        document.getElementById("status").innerText = "‚úÖ –ì–æ–ª–æ—Å –ø—Ä–∏–Ω—è—Ç! –°–ø–∞—Å–∏–±–æ!";
        loadResults();
        document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
      } else {
        throw new Error("–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");
      }
    } catch (err) {
      document.getElementById("status").innerText = `‚ùå –û—à–∏–±–∫–∞: ${err.message}`;
      console.error(err);
    }
  }

  loadHouses();
    async function loadResults() {
  try {
    const res = await fetch(`${WEB_APP_URL}?action=getResults`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const results = await res.json();

    const container = document.getElementById("results-container");
    if (results.length === 0) {
      container.innerHTML = "<p>–ü–æ–∫–∞ –Ω–µ—Ç –≥–æ–ª–æ—Å–æ–≤.</p>";
      return;
    }

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –≥–æ–ª–æ—Å–æ–≤
    results.sort((a, b) => b.–≥–æ–ª–æ—Å–æ–≤ - a.–≥–æ–ª–æ—Å–æ–≤);

    container.innerHTML = `
  <div class="results-box">
    <div class="results-title">–†–µ–π—Ç–∏–Ω–≥ –¥–æ–º–æ–≤</div>
    ${results.map(r => `
      <div class="result-row">
        <span>${r.–Ω–∞–∑–≤–∞–Ω–∏–µ}</span>
        <span class="result-count">${r.–≥–æ–ª–æ—Å–æ–≤} ${r.–≥–æ–ª–æ—Å–æ–≤ === 1 ? '–≥–æ–ª–æ—Å' : r.–≥–æ–ª–æ—Å–æ–≤ < 5 ? '–≥–æ–ª–æ—Å–∞' : '–≥–æ–ª–æ—Å–æ–≤'}</span>
      </div>
    `).join('')}
  </div>
`;
  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Ç–æ–≥–æ–≤:", err);
    document.getElementById("results-container").innerHTML = 
      `<p style="color:red">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Ç–æ–≥–∏</p>`;
  }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Ç–æ–≥–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –ø–æ—Å–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
loadResults();
</script>
</body>

</html>












