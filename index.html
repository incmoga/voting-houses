<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–í—ã–±–æ—Ä –¥–æ–º–∞</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    .house {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      margin: 12px;
      width: 280px;
      display: inline-block;
      vertical-align: top;
      background: white;
    }
    .house img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 4px;
    }
    input[type="text"] {
      padding: 8px;
      width: 300px;
      margin-bottom: 15px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: #45a049; }
    #status { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥–æ–º–∞ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</h2>
  <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" />

  <div id="houses-container">
    <!-- –î–æ–º–∞ –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è —Å—é–¥–∞ -->
  </div>

  <br><br>
  <button onclick="submitVote()">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å</button>
  <div id="status"></div>

  <script>
  // üî¥ –£–ë–ï–†–ò –ü–†–û–ë–ï–õ–´ –í –ö–û–ù–¶–ï URL!
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwrMeJhIM7_Hq9viUzcu7KXAGdv1brBFlWfP7Wvmx2a6L71HvpXgmIk06zFruYZBpl-vg/exec";

  async function loadHouses() {
    try {
      const res = await fetch(`${WEB_APP_URL}?action=getHouses`);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const houses = await res.json();
      
      const container = document.getElementById("houses-container");
      if (houses.length === 0) {
        container.innerHTML = "<p>–ù–µ—Ç –¥–æ–º–æ–≤ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.</p>";
        return;
      }

      container.innerHTML = houses.map(h => `
        <label class="house">
          <input type="checkbox" value="${h.id}">
          <img src="${h.—Ñ–æ—Ç–æ_url}" onerror="this.src='https://via.placeholder.com/300x150?text=–§–æ—Ç–æ+–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ'">
          <div><strong>${h.–Ω–∞–∑–≤–∞–Ω–∏–µ}</strong></div>
          <div>üí∞ –°—É—Ç–∫–∏: ${h.—Ü–µ–Ω–∞_—Å—É—Ç–∫–∏ || '‚Äî'} ‚ÇΩ</div>
          <div>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ 3 —Å–µ–º—å–∏ —Ç–æ–º—Å–∫–∏–µ: ${h.—Ü–µ–Ω–∞_—Ç–æ–º—Å–∫–∏–µ || '‚Äî'} ‚ÇΩ</div>
          <div>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ 1 —Å–µ–º—å—è: ${h.—Ü–µ–Ω–∞_–∫—Ä–∞—Å || '‚Äî'} ‚ÇΩ</div>
          <div>‚ú®–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ ${h.–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ || ''}</div>
          <div>üó∫Ô∏è –î–æ –≥–æ—Ä—ã: ${h.—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ || '‚Äî'} –∫–º</div>
          <div><a href="${h.–∞–≤–∏—Ç–æ_—Å—Å—ã–ª–∫–∞}" target="_blank" style="color: #0066cc; text-decoration: underline;">üîó –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –ê–≤–∏—Ç–æ</a></div>
        </label>
      `).join('');
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–º–æ–≤:", err);
      document.getElementById("houses-container").innerHTML = 
        `<p style="color:red">‚ùå –û—à–∏–±–∫–∞: ${err.message}</p>`;
    }
  }

  async function submitVote() {
    const name = document.getElementById("name").value.trim() || "–ê–Ω–æ–Ω–∏–º";
    const checked = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
      .map(el => el.value);

    if (checked.length === 0) {
      alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–æ–º!");
      return;
    }

    const housesParam = encodeURIComponent(checked.join(","));
    const url = `${WEB_APP_URL}?action=vote&name=${encodeURIComponent(name)}&houses=${housesParam}`;

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const result = await res.json();
      if (result.status === "ok") {
        document.getElementById("status").innerText = "‚úÖ –ì–æ–ª–æ—Å –ø—Ä–∏–Ω—è—Ç! –°–ø–∞—Å–∏–±–æ!";
        document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
      } else {
        throw new Error("–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É");
      }
    } catch (err) {
      document.getElementById("status").innerText = `‚ùå –û—à–∏–±–∫–∞: ${err.message}`;
      console.error(err);
    }
  }

  loadHouses();
</script>
</body>

</html>



